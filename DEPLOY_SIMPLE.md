# Простой деплой с логином и паролем

## Быстрый старт

### Настройка переменных окружения

#### Windows PowerShell:
```powershell
$env:REMOTE_USER = "root"
$env:REMOTE_PASSWORD = "ваш_пароль_от_сервера"
```

#### Linux/Mac:
```bash
export REMOTE_USER="root"
export REMOTE_PASSWORD="ваш_пароль_от_сервера"
```

### Деплой

```powershell
# Полный pipeline (commit + deploy)
.\commit_and_deploy.ps1 "My changes"

# Только деплой
.\deploy.ps1
```

При первом запуске скрипт может попросить установить дополнительные инструменты.

## GitHub Actions (автоматический деплой)

### Настройка секретов

1. Откройте: https://github.com/ednaiu/Stance-detection/settings/secrets/actions

2. Добавьте 3 секрета:

   **REMOTE_HOST**
   ```
   31.31.198.9
   ```

   **REMOTE_USER**
   ```
   root
   ```
   (или другое имя пользователя из панели reg.ru)

   **REMOTE_PASSWORD**
   ```
   ваш_пароль_от_сервера
   ```

3. Готово! Теперь каждый push в `main` автоматически задеплоит на сервер.

## Где взять логин и пароль?

### Вариант 1: Панель управления reg.ru

1. Войдите в личный кабинет: https://www.reg.ru/user/account/
2. Перейдите в **"Хостинг и VPS"** → **"Серверы"**
3. Выберите ваш сервер (31.31.198.9)
4. В разделе **"Управление сервером"** найдите:
   - **Логин**: обычно `root` или указан в настройках
   - **Пароль**: был отправлен на email при заказе VPS

### Вариант 2: Email от reg.ru

После заказа VPS вам пришло письмо с темой типа:
**"Ваш VPS сервер готов к работе"**

В письме указаны:
- IP адрес: 31.31.198.9
- Логин для SSH: root
- Пароль: (случайно сгенерированный)

### Вариант 3: Сбросить пароль

1. В панели reg.ru откройте ваш сервер
2. Найдите кнопку **"Сбросить пароль"** или **"Изменить пароль root"**
3. Новый пароль придет на email

## Требования

### Windows

При первом запуске автоматически установится **PuTTY** (plink/pscp).

Или установите вручную:
```powershell
choco install putty -y
```

### Linux/Mac

Автоматически установится **sshpass**.

Или установите вручную:
```bash
# Ubuntu/Debian
sudo apt-get install sshpass

# CentOS/RHEL
sudo yum install sshpass

# macOS
brew install hudochenkov/sshpass/sshpass
```

## Использование

### Вариант 1: С переменными окружения

```powershell
# Установить один раз в сессии
$env:REMOTE_USER = "root"
$env:REMOTE_PASSWORD = "ваш_пароль"

# Деплой
.\deploy.ps1
```

### Вариант 2: Интерактивный ввод

```powershell
# Просто запустите скрипт - он сам попросит ввести пароль
.\deploy.ps1
```

Пароль будет скрыт при вводе (не отображается на экране).

### Вариант 3: Автоматический через GitHub

Настройте секреты в GitHub (см. выше) и просто:

```powershell
git add -A
git commit -m "Update"
git push origin main
```

GitHub Actions автоматически задеплоит!

## Проверка деплоя

### Локально:
```powershell
# Проверка подключения
Test-NetConnection 31.31.198.9 -Port 5000

# Проверка API
curl http://31.31.198.9:5000/health
```

### На сервере:
```powershell
# Подключитесь к серверу
# При запросе пароля введите его
ssh root@31.31.198.9

# На сервере проверьте:
docker ps
docker logs stance-classifier
```

## Безопасность

⚠️ **Важно:**
- Не коммитьте файлы с паролями в git
- Используйте переменные окружения или секреты GitHub
- Регулярно меняйте пароли
- Для production рекомендуется использовать SSH ключи (см. SSH_SETUP_REGRU.md)

## Troubleshooting

### Ошибка: "plink not found" (Windows)

```powershell
# Установите PuTTY
choco install putty -y
```

### Ошибка: "sshpass not found" (Linux)

```bash
sudo apt-get install sshpass
```

### Ошибка: "Connection refused"

Проверьте:
1. Сервер доступен: `ping 31.31.198.9`
2. SSH порт открыт: `telnet 31.31.198.9 22`
3. Правильный пароль

### Ошибка: "Permission denied"

1. Проверьте логин и пароль
2. Возможно нужен другой пользователь (не root)
3. Сбросьте пароль в панели reg.ru

## Сравнение методов

| Метод | Безопасность | Сложность | Скорость |
|-------|--------------|-----------|----------|
| **Пароль** | ⭐⭐⭐ | ✅ Просто | ✅ Быстро |
| **SSH ключ** | ⭐⭐⭐⭐⭐ | ⚠️ Средне | ✅ Быстро |

Для быстрого старта и тестирования используйте **пароль**.
Для production используйте **SSH ключи** (см. SSH_SETUP_REGRU.md).
